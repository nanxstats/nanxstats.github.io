<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title> Architecting Large Shiny Apps with Minimal First Contentful Paint Time - Nan Xiao | 肖楠 </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="How to create a Shiny app with a loading screen that aims to minimize the first contentful paint (FCP) time." />

    
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:site_name" content="Nan Xiao | 肖楠" />
    <meta property="og:url" content="https://nanx.me/blog/post/shiny-fcp-loader/" />
    <meta property="og:title" content="Architecting Large Shiny Apps with Minimal First Contentful Paint Time" />
    <meta property="og:description" content="How to create a Shiny app with a loading screen that aims to minimize the first contentful paint (FCP) time." />
    <meta property="og:image" content="https://nanx.me/image/emma-fabbri-Vfs_zlhQr0o-unsplash.jpg" />
    <meta property="og:image:secure_url" content="https://nanx.me/image/emma-fabbri-Vfs_zlhQr0o-unsplash.jpg" />
    <meta property="article:published_time" content="2022-03-30T22:00:00Z" />
    <meta property="article:modified_time" content="2022-03-30T22:00:00Z" />
    <meta property="article:author" content="Nan Xiao" />

    
    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:site" content="@nanxstats">
    <meta name="twitter:creator" content="@nanxstats">
    
    <meta name="twitter:title" content="Architecting Large Shiny Apps with Minimal First Contentful Paint Time" />
    <meta name="twitter:description" content="How to create a Shiny app with a loading screen that aims to minimize the first contentful paint (FCP) time." />
    <meta name="twitter:image" content="https://nanx.me/image/emma-fabbri-Vfs_zlhQr0o-unsplash.jpg" />
    <meta name="twitter:image:alt" content="Architecting Large Shiny Apps with Minimal First Contentful Paint Time" />

    
    <meta property="og:linkedin:actor" content="nanxstats" />

    <link rel="canonical" href="https://nanx.me/blog/post/shiny-fcp-loader/">

    
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        serif: ['"Martina Plantijn"', 'Newsreader', 'Georgia', 'Cambria', '"Times New Roman"', 'Times', 'serif'],
                        sans: ['"Instrument Sans"', 'system-ui', '-apple-system', '"Segoe UI"', 'Roboto', '"Helvetica Neue"', 'Arial', 'sans-serif'],
                        mono: ['"Liga Noto Sans Mono"', 'ui-monospace', 'SFMono-Regular', '"SF Mono"', 'Menlo', 'Consolas', 'monospace'],
                    },
                    colors: {
                        paper: '#fdfdfd',
                        ink: '#1c1c1c',
                        accent: '#991b1b',  
                    },
                    typography: {
                        DEFAULT: {
                            css: {
                                maxWidth: 'none',
                                color: '#1c1c1c',
                                '--tw-prose-body': '#1c1c1c',
                                '--tw-prose-headings': '#1c1c1c',
                                '--tw-prose-links': '#991b1b',
                                '--tw-prose-bold': '#111827',
                                '--tw-prose-counters': '#71717a',
                                '--tw-prose-bullets': '#d4d4d8',
                                '--tw-prose-hr': '#e4e4e7',
                                '--tw-prose-quotes': '#1c1c1c',
                                '--tw-prose-quote-borders': '#d4d4d8',
                                '--tw-prose-captions': '#71717a',
                                '--tw-prose-code': '#1c1c1c',
                                '--tw-prose-pre-code': '#1c1c1c',
                                '--tw-prose-pre-bg': '#fdfdfd',
                                '--tw-prose-th-borders': '#d4d4d8',
                                '--tw-prose-td-borders': '#e4e4e7',
                                'pre': {
                                    color: '#1c1c1c',
                                    backgroundColor: '#fdfdfd !important',
                                    border: '1px solid #e4e4e7',
                                },
                                a: {
                                    color: '#991b1b',
                                    textDecoration: 'none',
                                    fontWeight: '400',
                                    borderBottom: '1px solid transparent',
                                    transition: 'border-color 0.2s ease, color 0.2s ease',
                                },
                                'a:hover': {
                                    color: '#991b1b !important',
                                    borderBottomColor: '#991b1b !important',
                                },
                                h1: { fontFamily: '"Instrument Sans", sans-serif', fontWeight: '500', letterSpacing: '-0.025em' },
                                h2: { fontFamily: '"Instrument Sans", sans-serif', fontWeight: '500', letterSpacing: '-0.025em', marginTop: '2em' },
                                h3: { fontFamily: '"Instrument Sans", sans-serif', fontWeight: '500' },
                                h4: { fontFamily: '"Instrument Sans", sans-serif', fontWeight: '500' },
                                blockquote: {
                                    fontStyle: 'italic',
                                    fontWeight: '400',
                                    borderLeftWidth: '2px',
                                },
                                'code::before': { content: 'none' },
                                'code::after': { content: 'none' },
                                ':not(pre) > code': {
                                    fontWeight: '400',
                                    color: '#1c1c1c !important',
                                    backgroundColor: '#f4f4f5 !important',
                                    padding: '0.2em 0.4em',
                                    borderRadius: '0.25rem',
                                    fontSize: '0.875em',
                                },
                            },
                        },
                    },
                },
            },
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .tufte-grid {
                display: grid;
                grid-template-columns: 1fr min(65ch, 100%) 1fr;
                column-gap: 2rem;
            }
            .tufte-grid > * {
                grid-column: 2;
            }
            .tufte-grid > .full-width {
                grid-column: 1 / -1;
            }
            .tufte-grid > .margin-note {
                grid-column: 3;
                font-family: "Instrument Sans", sans-serif;
                font-size: 0.875rem;
                line-height: 1.4;
                color: #52525b;  
                margin-top: 0.25rem;
            }
            @media (max-width: 1024px) {
                .tufte-grid {
                    grid-template-columns: 1rem 1fr 1rem;
                }
                .tufte-grid > .margin-note {
                    grid-column: 2;
                    margin-top: 0.5rem;
                    margin-bottom: 1rem;
                    padding-left: 1rem;
                    border-left: 2px solid #e4e4e7;
                }
            }
        }
    </style>

    <link rel="stylesheet" href="https://nanx.me/css/custom.css" />

    
    <link rel="stylesheet" href="https://nanx.me/css/textmate.css" />
    

    

    <link rel="shortcut icon"
        href="https://nanx.me/image/favicon.png">

    
</head>

<body class="bg-paper text-ink font-serif antialiased selection:bg-zinc-200">
    
<header class="py-8 lg:py-12 text-sm font-sans tracking-wide max-w-[67ch] mx-auto w-full px-4 sm:px-6">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 sm:gap-0">
        <a href="https://nanx.me/" class="font-medium text-ink hover:text-accent transition-colors">
            Nan Xiao
        </a>
        <nav class="flex flex-wrap gap-4 sm:gap-6 text-zinc-600">
            
            
            <a class="text-ink font-medium"
                href="https://nanx.me/blog/">
                Blog
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/software/">
                Software
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/papers/">
                Papers
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/talks/">
                Talks
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/books/">
                Books
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/about/">
                About
            </a>
            
        </nav>
    </div>
</header>

<main class="content my-10 lg:my-20 max-w-[65ch] mx-auto w-full px-4 sm:px-6">
    <article>
        <header class="mb-14">
            <h1 class="text-3xl lg:text-4xl font-sans tracking-tight text-ink font-medium mb-4">Architecting Large Shiny Apps with Minimal First Contentful Paint Time</h1>

            <div class="text-zinc-500 font-sans text-sm tracking-wide">
                
                
                <span class="author" title="Nan Xiao">
                    Nan Xiao
                </span>
                
                

                <span class="date middot" title='Wed Mar 30 2022 22:00:00 UTC'>
                    March 30, 2022
                </span>

                <span class="reading-time middot">
                    3 min read
                </span>

                <div class="mt-8 flex flex-wrap gap-2">
                    
                    <a href="https://nanx.me/tags/r"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-zinc-100 text-zinc-600 hover:bg-zinc-200 hover:text-ink transition-colors text-xs font-medium tracking-wide">
                        R
                    </a>
                    
                    <a href="https://nanx.me/tags/shiny"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-zinc-100 text-zinc-600 hover:bg-zinc-200 hover:text-ink transition-colors text-xs font-medium tracking-wide">
                        shiny
                    </a>
                    
                    <a href="https://nanx.me/tags/software-architecture"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-zinc-100 text-zinc-600 hover:bg-zinc-200 hover:text-ink transition-colors text-xs font-medium tracking-wide">
                        software architecture
                    </a>
                    
                    <a href="https://nanx.me/tags/loading-screen"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-zinc-100 text-zinc-600 hover:bg-zinc-200 hover:text-ink transition-colors text-xs font-medium tracking-wide">
                        loading screen
                    </a>
                    
                    <a href="https://nanx.me/tags/first-contentful-paint"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-zinc-100 text-zinc-600 hover:bg-zinc-200 hover:text-ink transition-colors text-xs font-medium tracking-wide">
                        first contentful paint
                    </a>
                    
                    
                    
                </div>
            </div>

        </header>

        <div class="prose prose-zinc max-w-none">
            
    


<blockquote>
<p>The Shiny app skeleton is available from
<a href="https://github.com/nanxstats/shiny-fcp-loader">nanxstats/shiny-fcp-loader</a>.</p>
</blockquote>
<div class="figure">
<img src="https://nanx.me/image/emma-fabbri-Vfs_zlhQr0o-unsplash.jpg" alt="" />
<p class="caption">Pantheon, Roma, Italy. Photo by <a href="https://unsplash.com/photos/Vfs_zlhQr0o">Emma Fabbri</a>.</p>
</div>
<p>More than a few people asked me similar questions about this when building
large shiny apps. Therefore, it might be time to formulate a simple solution
with a minimalist yet extensible code demo.</p>
<div id="ux-side-effects-of-large-shiny-apps" class="section level2">
<h2>UX side effects of large Shiny apps</h2>
<p>For larger Shiny apps, users could wait a long time (in terms of 10s of seconds)
with an awkward blank screen before seeing the rendered app content.
There are many possible reasons, but the common ones are:</p>
<ul>
<li>Loading a considerable number of render-blocking CSS/JS dependencies.</li>
<li>Initializing the app state with some intensive computation.</li>
<li>Connecting to servers with bandwidth and response time limitations.</li>
</ul>
</div>
<div id="the-solution" class="section level2">
<h2>The solution</h2>
<p>I created an example app at <a href="https://github.com/nanxstats/shiny-fcp-loader" class="uri">https://github.com/nanxstats/shiny-fcp-loader</a>,
with a demo deployed at <a href="https://nanx.shinyapps.io/shiny-fcp-loader/" class="uri">https://nanx.shinyapps.io/shiny-fcp-loader/</a>.
The goal is to minimize the <a href="https://web.dev/fcp/">First Contentful Paint (FCP)</a> time.</p>
<p>This Shiny app solves the problems on the app code level by:</p>
<ul>
<li>Implementing a loading screen (loader); hiding it after the main UI resources
are loaded + the state initialization is finished.</li>
<li>Prioritizing loading the loader-related code (mostly CSS, maybe JS) so it can
render before the main UI assets.</li>
<li>Loading and rendering the main UI assets later separately without blocking
the rendering of the loader.</li>
</ul>
</div>
<div id="technical-details" class="section level2">
<h2>Technical details</h2>
<p>Here is how the logic looks at the entry point of the Shiny app (<code>app.R</code>):</p>
<pre class="r"><code>ui &lt;- function(request) {
  tagList(
    useLoader(),
    shinyjs::useShinyjs(),
    uiOutput(&quot;ui_main&quot;)
  )
}

server &lt;- function(input, output, session) {
  output$ui_main &lt;- renderUI(source(&quot;ui/main.R&quot;, local = TRUE)$value)
  source(&quot;server/main.R&quot;, local = TRUE)$value
  shinyjs::delay(15000, shinyjs::hide(&quot;loading&quot;))
}

shinyApp(ui, server)</code></pre>
<ul>
<li>The CSS loader is formally defined by using <code>htmltools::htmlDependency()</code>
and then attached so that it can be loaded first as an isolated dependency.</li>
<li>Instead of defining the main UI directly in the UI function, we render the UI
using <code>renderUI()</code> on the server side and used <code>uiOutput()</code> to output it.
This makes the main UI loaded and rendered separately after the loader.</li>
<li>The loader should be hidden when the main UI assets are loaded,
while we also want to cover the case where the lengthy initialization is
from computing. Therefore, we added a delay as another safeguard.
One can tune the delay parameter (in ms) if they have a rough estimate for
the computation to finish based on where the app is deployed.</li>
</ul>
<p>I also applied the idea of <a href="https://atomicdesign.bradfrost.com/">Atomic Design</a>
to decouple the UI and server components so that the app structure is easy to
understand and scale.</p>
</div>
<div id="waterfall-chart" class="section level2">
<h2>Waterfall chart</h2>
<p>Let’s check how the app is loaded using the waterfall chart in Chrome DevTools
under the Network tab:</p>
<p><img src="waterfall-chart.jpg" width="100%" /></p>
<p>We can see that our loader is loaded and rendered at the very beginning, way
before the XHR requests (which could be WebSocket requests in other cases)
in the middle. These requests would trigger the rendering and loading of
the main UI assets.</p>
<p>To see how a minimal first contentful paint time helps more dramatically,
you can simulate a limited bandwidth scenario by selecting Chrome DevTools →
Network → Throttle → Fast 3G. This limits the loading speed of all resources.</p>
</div>
<div id="lighthouse" class="section level2">
<h2>Lighthouse</h2>
<p>We can also measure the page loading performance using
<a href="https://developer.chrome.com/docs/lighthouse/overview/">Lighthouse</a>.</p>
<p>It took 0.4 seconds (locally) to achieve First Contentful Paint.
We only have 4 render-blocking resources: two from the loader,
two from Shiny essentials.</p>
<p><img src="lighthouse.jpg" width="100%" /></p>
<p>I hope this example could help you build large Shiny apps with a
better user experience in the future.</p>
</div>
<div id="bonus-thoughts" class="section level2">
<h2>Bonus thoughts</h2>
<p>The <code>-&gt;</code> assignment operator makes more sense logically and aesthetically
if we write the server code like below, especially if you use a coding font
with programming ligatures for <code>|&gt;</code> and <code>-&gt;</code>:</p>
<pre class="r"><code>server &lt;- function(input, output, session) {
  source(&quot;uiuiui/main.R&quot;, local = TRUE)$value |&gt; renderUI() -&gt; output$ui_main
  source(&quot;server/main.R&quot;, local = TRUE)$value
}</code></pre>
<p>I guess this feeling was also discussed
<a href="https://win-vector.com/2016/12/12/the-case-for-using-in-r/">here</a> by John Mount.</p>
</div>



        </div>

        
        <nav class="pagination-nav mt-10 mb-3" aria-label="Blog post navigation">
            <div class="navigation-btns">
                
                <a href="https://nanx.me/blog/post/link-checker/" class="btn-nav btn-prev w-full">
                    <div class="btn-content">
                        <div class="pagination-nav-sublabel">Previous</div>
                        <div class="pagination-nav-label">&laquo; A Simple Link Checker for Hugo and Blogdown Websites</div>
                    </div>
                </a>
                

                
                <a href="https://nanx.me/blog/post/ggplot2-color-interpolation/" class="btn-nav btn-next w-full">
                    <div class="btn-content">
                        <div class="pagination-nav-sublabel">Next</div>
                        <div class="pagination-nav-label">Adaptive ggplot2 Color Scales with Color Interpolation &raquo;</div>
                    </div>
                </a>
                
            </div>
        </nav>
        

    </article>
</main>

<section id="comments">
    <div class="py-3 content">
        <div class="mx-auto max-w-[65ch] w-full px-4 sm:px-6">
            <div class="comments">
                <script src="https://utteranc.es/client.js" repo="nanxstats/blog-comments" issue-term="pathname"
                    label="comment" theme="github-light" crossorigin="anonymous" async>
                    </script>
            </div>
        </div>
    </div>
</section>
<footer class="mt-20 mb-10 text-center font-sans text-sm text-zinc-500 tracking-wide">
    <div class="tufte-grid">
        <div class="flex flex-col items-center gap-4">
            <div class="flex flex-wrap items-center justify-center gap-x-4 gap-y-2">
                
                
                <a href="https://github.com/nanxstats" target="_blank" rel="noopener"
                    class="hover:text-accent transition-colors">GitHub</a>
                
                
                
                
                <a href="https://www.linkedin.com/in/nanxstats" target="_blank" rel="noopener"
                    class="hover:text-accent transition-colors">LinkedIn</a>
                
                
                <a href="https://bsky.app/profile/nanxstats.bsky.social" target="_blank" rel="noopener"
                    class="hover:text-accent transition-colors">Bluesky</a>
                
                
                <a href="https://twitter.com/nanxstats" target="_blank" rel="noopener"
                    class="hover:text-accent transition-colors">Twitter</a>
                
                
                
                <a href="https://nanx.me/colophon/" class="hover:text-accent transition-colors">Colophon</a>
                
                
            </div>

            
            <div class="mt-2">
                © 2026 Nan Xiao. All rights reserved.
            </div>
            
        </div>
    </div>
</footer>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"
        integrity="sha512-EBLzUL8XLl+va/zAsmXwS7Z2B1F9HUHkZwyS/VKwh3S7T/U0nF4BaU29EP/ZSf6zgiIxYAnKLu6bJ8dqpmX5uw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/r.min.js" defer></script>
    
    <script>
        window.addEventListener('load', function () {
            hljs.highlightAll();
        }, true);
    </script>
    

    

    
    
    
<script src="https://nanx.me/js/math-code.js"></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
</body>

</html>