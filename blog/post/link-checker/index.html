<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title> A Simple Link Checker for Hugo and Blogdown Websites - Nan Xiao | 肖楠 </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="How to create a broken link checker for Hugo and blogdown websites." />
    <meta property="og:site_name" content="Nan Xiao | 肖楠" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://nanx.me/blog/post/link-checker/" />
    <meta property="og:title" content="A Simple Link Checker for Hugo and Blogdown Websites" />
    <meta property="og:image" content="https://nanx.me/image/katie-treadway-EwE4tBYh3ms-unsplash.jpg" />
    <meta property="og:description" content="How to create a broken link checker for Hugo and blogdown websites." />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:site" content="@nanxstats">
    <meta name="twitter:creator" content="@nanxstats">
    
    <meta name="twitter:title" content="A Simple Link Checker for Hugo and Blogdown Websites" />
    <meta name="twitter:description" content="How to create a broken link checker for Hugo and blogdown websites." />
    <meta name="twitter:image" content="https://nanx.me/image/katie-treadway-EwE4tBYh3ms-unsplash.jpg" />

    <link rel="canonical" href="https://nanx.me/blog/post/link-checker/">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" integrity="sha512-GQGU0fMMi238uA+a/bdWJfpUGKUkBdgfFdgBm72SUQ6BeyWjoY/ton0tEjH+OSH9iP4Dfh+7HM0I9f5eR0L/4w==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="https://nanx.me/css/custom.css" />

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/github.min.css" integrity="sha512-0aPQyyeZrWj9sCA46UlmWgKOP0mUipLQ6OZXu8l4IcAmD2u31EPEy9VcIMvl7SoAaKe8bLXZhYoMaE/in+gcgA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    

    

    <link rel="shortcut icon"
        href="https://nanx.me/image/favicon.png">

    
    <link href="https://nanx.me/index.xml" rel="alternate" type="application/rss+xml" title="Nan Xiao | 肖楠" />
    
</head>

<body>
    
<div class="my-4 my-lg-5 header">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-sm-12 col-lg-6">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        
                        <a href="https://nanx.me/">
                            <img class="logo img-fluid d-block rounded-circle"
                                src="https://nanx.me/image/nanxiao.jpg" alt="Portrait of Nan Xiao">
                        </a>
                        
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <a href="https://nanx.me/">
                            <h1 class="name">Nan Xiao</h1>
                        </a>

                        <ul class="nav nav-primary">
                            
                            <li class="nav-item">
                                <a class="nav-link text-blog"
                                    href="https://nanx.me/blog/">
                                    
                                    Blog
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link text-software"
                                    href="https://nanx.me/software/">
                                    
                                    Software
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link text-papers"
                                    href="https://nanx.me/papers/">
                                    
                                    Papers
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link text-talks"
                                    href="https://nanx.me/talks/">
                                    
                                    Talks
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link text-books"
                                    href="https://nanx.me/books/">
                                    
                                    Books
                                </a>
                            </li>
                            
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="content">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-sm-12 col-lg-6">
                <h1 class="blog-post-title">A Simple Link Checker for Hugo and Blogdown Websites</h1>

                <div class="mb-md-4 meta">
                    
                    
                    <span class="author" title="Nan Xiao">
                        Nan Xiao
                    </span>
                    
                    

                    <span class="date middot" title='Tue Feb 22 2022 20:00:00 UTC'>
                        2022-02-22
                    </span>

                    <span class="reading-time middot">
                        4 min read
                    </span>

                    <div class="d-none d-md-inline tags">
                        <ul class="list-unstyled d-inline">
                            
                            <li class="d-inline middot">
                                <a href="https://nanx.me/tags/r">R</a>
                            </li>
                            
                            <li class="d-inline middot">
                                <a href="https://nanx.me/tags/link-checker">link checker</a>
                            </li>
                            
                            <li class="d-inline middot">
                                <a href="https://nanx.me/tags/automation">automation</a>
                            </li>
                            
                            <li class="d-inline middot">
                                <a href="https://nanx.me/tags/hugo">Hugo</a>
                            </li>
                            
                            <li class="d-inline middot">
                                <a href="https://nanx.me/tags/blogdown">blogdown</a>
                            </li>
                            
                            <li class="d-inline middot">
                                <a href="https://nanx.me/tags/urlchecker">urlchecker</a>
                            </li>
                            
                        </ul>
                    </div>

                    <div class="d-none d-md-inline tags">
                        <ul class="list-unstyled d-inline">
                            
                            
                        </ul>
                    </div>
                </div>

                <div class="markdown blog-post-content">
                    
    
<script src="https://nanx.me/blog/post/link-checker/index_files/header-attrs/header-attrs.js"></script>


<div class="figure">
<img src="https://nanx.me/image/katie-treadway-EwE4tBYh3ms-unsplash.jpg" alt="" />
<p class="caption">Photo by <a href="https://unsplash.com/photos/EwE4tBYh3ms">Katie Treadway</a>.</p>
</div>
<div id="some-background" class="section level2">
<h2>Some background</h2>
<p>I have been blogging with Hugo/blogdown for a while.
One housekeeping task I have always wanted to <a href="https://nanx.me/blog/post/general-purpose-programming-with-r/">automate with R</a>
is scanning the entire website to ensure that all the links are still working.
It is essential for maintaining an enjoyable reading experience without
<a href="https://nanx.me/blog/post/save-the-link-like-a-boss/">archiving</a> too many
external links.</p>
<p>Conceptually, the requirement for a generic broken link checker is quite simple:</p>
<ul>
<li>Get the links to all pages on the site.</li>
<li>Scrape and parse the pages to get the links contained.</li>
<li>Check the link status.</li>
</ul>
<p>However, getting the links to all pages may involve recursive scraping and
parsing of a site. It could make the program behavior unpredictable and
add too many lines for exception handling.</p>
<p>It is dramatically easier if we consider a more specific checker for
Hugo and blogdown websites with certain configurations. For example,
the <a href="https://gohugo.io/templates/sitemap-template/">built-in sitemap in Hugo</a>
allows us to discover the links to all internal pages with one simple
step of XML parsing.</p>
<p>We also have a decent infrastructure in R for page parsing and link checking:</p>
<ul>
<li><a href="https://xml2.r-lib.org/">xml2</a> and <a href="https://rvest.tidyverse.org/">rvest</a>
to parse and extract elements from the XML and HTML;</li>
<li><a href="https://cran.r-project.org/package=urlchecker">urlchecker</a> to check
links in parallel, with informative feedback.
It was initially built for checking the links in R packages before
submitting to CRAN but can be easily repurposed.</li>
</ul>
<p>Let’s try building a minimum viable link checker with these in mind.</p>
</div>
<div id="get-the-links" class="section level2">
<h2>Get the links</h2>
<p>We first use the sitemap to get the links to all internal pages,
then parse every internal page to extract the links contained.
With the help of xml2 and rvest, we only need a few lines of code:</p>
<pre class="r"><code>#&#39; Get all links on Hugo/blogdown site
#&#39;
#&#39; @param sitemap Sitemap URL of a Hugo/blogdown site
#&#39; @return Character vector of links from all pages
get_blogdown_links &lt;- function(sitemap) {
  lst &lt;- sitemap |&gt;
    xml2::read_xml() |&gt;
    xml2::as_list()
  urlset &lt;- lst[[&quot;urlset&quot;]] |&gt;
    sapply(&quot;[[&quot;, &quot;loc&quot;) |&gt;
    unlist(use.names = FALSE) |&gt;
    unique()

  content &lt;- lapply(urlset, xml2::read_html)
  extract_links &lt;- function(x, tag, attr) {
    x |&gt;
      rvest::html_elements(tag) |&gt;
      rvest::html_attr(attr)
  }

  lapply(content, extract_links, tag = &quot;a&quot;, attr = &quot;href&quot;) |&gt;
    unlist() |&gt;
    unique()
}</code></pre>
<p>The returned vector will contain both internal and external links.</p>
</div>
<div id="check-link-status" class="section level2">
<h2>Check link status</h2>
<p>We can write the links into a file under a minimally sufficient R package
format so that <code>urlchecker::url_check()</code> thinks this is an R package
and can proceed to check them.</p>
<pre class="r"><code>#&#39; Create a mockup package containing all links to check
#&#39;
#&#39; @param links Character vector of links to check
#&#39; @return Path to the package
use_mockup_pkg &lt;- function(links) {
  pkgname &lt;- paste(sample(letters, size = 10, replace = TRUE), collapse = &quot;&quot;)
  pkgpath &lt;- file.path(tempdir(), pkgname)
  dir.create(pkgpath)
  writeLines(paste0(&quot;&lt;&quot;, links, &quot;&gt;&quot;), con = file.path(pkgpath, &quot;README.md&quot;))
  writeLines(c(&quot;Package: placeholder&quot;), con = file.path(pkgpath, &quot;DESCRIPTION&quot;))
  pkgpath
}</code></pre>
<p>Connect the pipes:</p>
<pre class="r"><code>&quot;https://nanx.me/sitemap.xml&quot; |&gt;
  get_blogdown_links() |&gt;
  use_mockup_pkg() |&gt;
  urlchecker::url_check()</code></pre>
<p>The outputs are self-explanatory. Most of the data points for my site
are graceful <a href="https://yihui.org/en/2017/11/301-redirect/">301 redirects</a>,
including common patterns such as HTTP to HTTPS migration,
change of host domain names, and change of URL path scheme.
Sometimes, there is a straightforward 404 that should be fixed.</p>
<pre class="text"><code>! Warning: README.md:286:2 Moved
&lt;http://jmlr.csail.mit.edu/papers/volume10/weinberger09a/weinberger09a.pdf&gt;
 ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 https://jmlr.csail.mit.edu/papers/volume10/weinberger09a/weinberger09a.pdf

...

! Warning: README.md:352:2 Moved
&lt;https://blog.github.com/2018-05-01-github-pages-custom-domains-https/&gt;
 ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 https://github.blog/2018-05-01-github-pages-custom-domains-https/

...

! Warning: README.md:285:2 Moved
&lt;https://dl.acm.org/citation.cfm?id=2968618.2968683&gt;
 ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 https://dl.acm.org/doi/10.5555/2968618.2968683

...

x Error: README.md:404:2 404: Not Found
&lt;https://www.math.ualberta.ca/mss/misc/A%20Mathematician&#39;s%20Apology.pdf&gt;
 ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</code></pre>
</div>
<div id="limitations" class="section level2">
<h2>Limitations</h2>
<p>A few limitations of this simple checker:</p>
<ul>
<li>This checker did not handle the case where relative URLs are used for
linking internal pages. It worked for me because
<ul>
<li>I use absolute URLs to link all pages when
creating content, even if it is an internal resource;</li>
<li>I also did not enable <code>relativeURLs</code> in the
<a href="https://gohugo.io/content-management/urls/#relative-urls">Hugo configuration</a>.
Therefore, all rendered links to internal pages are absolute URLs.</li>
</ul></li>
<li>This checker did not check resources linked using a tag other than <code>&lt;a&gt;</code>,
such as images linked with <code>&lt;img src="..."&gt;</code>.
<ul>
<li>It is trivial to extend it to handle resources linked with other
HTML tags and attributes.</li>
<li>For external resources such as images, I have the habit of saving
and serving a local copy while explicitly linking the source with
<code>&lt;a&gt;</code> whenever possible.</li>
</ul></li>
</ul>
</div>



                </div>

                
                <div class="navigation">
                    <div class="row">
                        <div class="col-12 col-lg-6">
                            
                            <div class="mt-4 text-start">
                                <a href="https://nanx.me/blog/post/font-variant-numeric/">« Font Variant Numeric</a>
                            </div>
                            
                        </div>
                        <div class="col-12 col-lg-6">
                            
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
</div>

<section id="comments">
    <div class="py-3 content">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-sm-12 col-lg-6">
                    <div class="comments">
                        <script src="https://utteranc.es/client.js" repo="nanxstats/blog-comments"
                            issue-term="pathname" label="comment" theme="github-light" crossorigin="anonymous" async>
                            </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<div class="footer mt-5">
    <div class="container">

        <div class="row justify-content-center">
            <div class="col-sm-12 col-lg-6">
                <hr>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-sm-12 col-lg-6">
                
                <div class="site-copyright">
                    © 2011–2022 Nan Xiao
                </div>
                
            </div>
        </div>
        <div class="row justify-content-center mt-1 mb-5">
            <div class="col-sm-12 col-lg-6">
                <div class="site-social">
                    <ul>
                        

                        
                        <li><a href="https://github.com/nanxstats" target="_blank"
                                rel="noopener">GitHub</a></li>
                        

                        

                        

                        
                        <li><a href="https://twitter.com/nanxstats" target="_blank"
                                rel="noopener">Twitter</a></li>
                        

                        
                        <li><a href="https://www.linkedin.com/in/nanxstats" target="_blank"
                                rel="noopener">LinkedIn</a></li>
                        

                        
                        <li><a href="https://nanx.me/colophon/">Colophon</a></li>
                        

                        
                        <li><a href="https://nanx.me/index.xml" class="mr-0">RSS</a></li>
                        

                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>


    

    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js" integrity="sha512-Pbb8o120v5/hN/a6LjF4N4Lxou+xYZ0QcVF8J6TWhBbHmctQWd8O6xTDmHpE/91OjPzCk4JRoiJsexHYg4SotQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/languages/r.min.js" defer></script>
        
        <script>
            window.addEventListener('load', function() {
                hljs.highlightAll();
            }, true);
        </script>
    

    

    
    
        

    
</body>

</html>
