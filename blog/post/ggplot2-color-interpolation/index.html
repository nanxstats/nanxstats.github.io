<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title> Adaptive ggplot2 Color Scales with Color Interpolation - Nan Xiao | 肖楠 </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="Create discrete ggplot2 color scales that are adaptive to the number of categories in the data." />

    
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:site_name" content="Nan Xiao | 肖楠" />
    <meta property="og:url" content="https://nanx.me/blog/post/ggplot2-color-interpolation/" />
    <meta property="og:title" content="Adaptive ggplot2 Color Scales with Color Interpolation" />
    <meta property="og:description" content="Create discrete ggplot2 color scales that are adaptive to the number of categories in the data." />
    <meta property="og:image" content="https://nanx.me/image/mateo-giraud-wtBex4wQw60-unsplash.jpg" />
    <meta property="og:image:secure_url" content="https://nanx.me/image/mateo-giraud-wtBex4wQw60-unsplash.jpg" />
    <meta property="article:published_time" content=" 2022-04-06T01:30:00Z" />
    <meta property="article:modified_time" content=" 2022-04-06T01:30:00Z" />
    <meta property="article:author" content="Nan Xiao" />

    
    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:site" content="@nanxstats">
    <meta name="twitter:creator" content="@nanxstats">
    
    <meta name="twitter:title" content="Adaptive ggplot2 Color Scales with Color Interpolation" />
    <meta name="twitter:description" content="Create discrete ggplot2 color scales that are adaptive to the number of categories in the data." />
    <meta name="twitter:image" content="https://nanx.me/image/mateo-giraud-wtBex4wQw60-unsplash.jpg" />
    <meta name="twitter:image:alt" content="Adaptive ggplot2 Color Scales with Color Interpolation" />

    
    <meta property="og:linkedin:actor" content="nanxstats" />

    <link rel="canonical" href="https://nanx.me/blog/post/ggplot2-color-interpolation/">

    
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        serif: ['"Martina Plantijn"', 'Newsreader', 'Georgia', 'Cambria', '"Times New Roman"', 'Times', 'serif'],
                        sans: ['"Instrument Sans"', 'system-ui', '-apple-system', '"Segoe UI"', 'Roboto', '"Helvetica Neue"', 'Arial', 'sans-serif'],
                        mono: ['"Liga Noto Sans Mono"', 'ui-monospace', 'SFMono-Regular', '"SF Mono"', 'Menlo', 'Consolas', 'monospace'],
                    },
                    colors: {
                        paper: '#fdfdfd',
                        ink: '#1c1c1c',
                        accent: '#991b1b',  
                    },
                    typography: {
                        DEFAULT: {
                            css: {
                                maxWidth: 'none',
                                color: '#1c1c1c',
                                '--tw-prose-body': '#1c1c1c',
                                '--tw-prose-headings': '#1c1c1c',
                                '--tw-prose-links': '#991b1b',
                                '--tw-prose-bold': '#111827',
                                '--tw-prose-counters': '#71717a',
                                '--tw-prose-bullets': '#d4d4d8',
                                '--tw-prose-hr': '#e4e4e7',
                                '--tw-prose-quotes': '#1c1c1c',
                                '--tw-prose-quote-borders': '#d4d4d8',
                                '--tw-prose-captions': '#71717a',
                                '--tw-prose-code': '#1c1c1c',
                                '--tw-prose-pre-code': '#1c1c1c',
                                '--tw-prose-pre-bg': '#fdfdfd',
                                '--tw-prose-th-borders': '#d4d4d8',
                                '--tw-prose-td-borders': '#e4e4e7',
                                'pre': {
                                    color: '#1c1c1c',
                                    backgroundColor: '#fdfdfd !important',
                                    border: '1px solid #e4e4e7',
                                },
                                a: {
                                    color: '#991b1b',
                                    textDecoration: 'none',
                                    fontWeight: '400',
                                    borderBottom: '1px solid transparent',
                                    transition: 'border-color 0.2s ease, color 0.2s ease',
                                },
                                'a:hover': {
                                    color: '#991b1b !important',
                                    borderBottomColor: '#991b1b !important',
                                },
                                h1: { fontFamily: '"Instrument Sans", sans-serif', fontWeight: '500', letterSpacing: '-0.025em' },
                                h2: { fontFamily: '"Instrument Sans", sans-serif', fontWeight: '500', letterSpacing: '-0.025em', marginTop: '2em' },
                                h3: { fontFamily: '"Instrument Sans", sans-serif', fontWeight: '500' },
                                h4: { fontFamily: '"Instrument Sans", sans-serif', fontWeight: '500' },
                                blockquote: {
                                    fontStyle: 'italic',
                                    fontWeight: '400',
                                    borderLeftWidth: '2px',
                                },
                                'code::before': { content: 'none' },
                                'code::after': { content: 'none' },
                                ':not(pre) > code': {
                                    fontWeight: '400',
                                    color: '#1c1c1c !important',
                                    backgroundColor: '#f4f4f5 !important',
                                    padding: '0.2em 0.4em',
                                    borderRadius: '0.25rem',
                                    fontSize: '0.875em',
                                },
                            },
                        },
                    },
                },
            },
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .tufte-grid {
                display: grid;
                grid-template-columns: 1fr min(65ch, 100%) 1fr;
                column-gap: 2rem;
            }
            .tufte-grid > * {
                grid-column: 2;
            }
            .tufte-grid > .full-width {
                grid-column: 1 / -1;
            }
            .tufte-grid > .margin-note {
                grid-column: 3;
                font-family: "Instrument Sans", sans-serif;
                font-size: 0.875rem;
                line-height: 1.4;
                color: #52525b;  
                margin-top: 0.25rem;
            }
            @media (max-width: 1024px) {
                .tufte-grid {
                    grid-template-columns: 1rem 1fr 1rem;
                }
                .tufte-grid > .margin-note {
                    grid-column: 2;
                    margin-top: 0.5rem;
                    margin-bottom: 1rem;
                    padding-left: 1rem;
                    border-left: 2px solid #e4e4e7;
                }
            }
        }
    </style>

    <link rel="stylesheet" href="https://nanx.me/css/custom.css" />

    
    <link rel="stylesheet" href="https://nanx.me/css/textmate.css" />
    

    

    <link rel="shortcut icon"
        href="https://nanx.me/image/favicon.png">

    
</head>

<body class="bg-paper text-ink font-serif antialiased selection:bg-zinc-200">
    
<header class="py-8 lg:py-12 text-sm font-sans tracking-wide max-w-[67ch] mx-auto w-full px-4 sm:px-6">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 sm:gap-0">
        <a href="https://nanx.me/" class="font-medium text-ink hover:text-accent transition-colors">
            Nan Xiao
        </a>
        <nav class="flex flex-wrap gap-4 sm:gap-6 text-zinc-600">
            
            
            <a class="text-ink font-medium"
                href="https://nanx.me/blog/">
                Blog
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/software/">
                Software
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/papers/">
                Papers
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/talks/">
                Talks
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/books/">
                Books
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/about/">
                About
            </a>
            
        </nav>
    </div>
</header>

<main class="content my-10 lg:my-20 max-w-[65ch] mx-auto w-full px-4 sm:px-6">
    <article>
        <header class="mb-14">
            <h1 class="text-3xl lg:text-4xl font-sans tracking-tight text-ink font-medium mb-4">Adaptive ggplot2 Color Scales with Color Interpolation</h1>

            <div class="text-zinc-500 font-sans text-sm tracking-wide">
                
                
                <span class="author" title="Nan Xiao">
                    Nan Xiao
                </span>
                
                

                <span class="date middot" title='Wed Apr 6 2022 01:30:00 UTC'>
                    April 6, 2022
                </span>

                <span class="reading-time middot">
                    3 min read
                </span>

                <div class="mt-8 flex flex-wrap gap-2">
                    
                    <a href="https://nanx.me/%20tags/r"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-zinc-100 text-zinc-600 hover:bg-zinc-200 hover:text-ink transition-colors text-xs font-medium tracking-wide">
                        R
                    </a>
                    
                    <a href="https://nanx.me/%20tags/ggplot2"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-zinc-100 text-zinc-600 hover:bg-zinc-200 hover:text-ink transition-colors text-xs font-medium tracking-wide">
                        ggplot2
                    </a>
                    
                    <a href="https://nanx.me/%20tags/color-scales"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-zinc-100 text-zinc-600 hover:bg-zinc-200 hover:text-ink transition-colors text-xs font-medium tracking-wide">
                        color scales
                    </a>
                    
                    <a href="https://nanx.me/%20tags/color-interpolation"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-zinc-100 text-zinc-600 hover:bg-zinc-200 hover:text-ink transition-colors text-xs font-medium tracking-wide">
                        color interpolation
                    </a>
                    
                    
                    
                </div>
            </div>

        </header>

        <div class="prose prose-zinc max-w-none">
            
    


<div class="float">
<img src="https://nanx.me/image/mateo-giraud-wtBex4wQw60-unsplash.jpg" alt="Photo by Mateo Giraud." />
<div class="figcaption">Photo by <a href="https://unsplash.com/photos/wtBex4wQw60">Mateo Giraud</a>.</div>
</div>
<p>My R package <a href="https://github.com/nanxstats/ggsci">ggsci</a> has included a few
popular discrete color palettes.
The colors values in these palettes are not automatically generated from a
color space but hand-picked instead, often containing only five to ten
distinct colors.
A <a href="https://github.com/nanxstats/ggsci/issues/8">frequent question</a> from the
users is: What should I do when the colors are running out due to a more
significant number of categories in the data?</p>
<p>Better approaches may exist, but an <em>ad hoc</em> method is to interpolate
the color values to generate more colors based on the number of categories.
Here, I will demonstrate how to construct such an “adaptive” color palette
generator and the ggplot2 color scales for all ggsci color palettes.</p>
<blockquote>
<p>CAUTION: It might be better not to encode too many categories in different colors.
Please see the recommendations from the
<a href="https://clauswilke.com/dataviz/color-pitfalls.html">common pitfalls of color use</a>
chapter in the <em>Fundamentals of Data Visualization</em> book by Claus O. Wilke.</p>
</blockquote>
<p>We start with the color interpolation logic as a
<a href="https://adv-r.hadley.nz/function-factories.html">function factory</a>
and leverage <code>grDevices::colorRampPalette()</code>.</p>
<pre class="r"><code>#&#39; Adaptive palette (discrete)
#&#39;
#&#39; Create a discrete palette that will use the first `n` colors from
#&#39; the supplied color values when the palette has enough colors.
#&#39; Otherwise, use an interpolated color palette.
#&#39;
#&#39; @param values Color values.
pal_ramp &lt;- function(values) {
  force(values)
  function(n) {
    if (n &lt;= length(values)) {
      values[seq_len(n)]
    } else {
      colorRampPalette(values, alpha = TRUE)(n)
    }
  }
}</code></pre>
<p>Then, we create a color palette generator function,
similar to the existing color palette generator functions in ggsci.
The main difference here is that you can access and interpolate the raw color
values of any palettes in ggsci.</p>
<pre class="r"><code>#&#39; Adaptive color palette generator
#&#39;
#&#39; Adaptive color palette generator for ggsci color palettes using `pal_ramp()`.
#&#39;
#&#39; @param name Color palette name in ggsci
#&#39; @param palette Color palette type in ggsci
#&#39; @param alpha Transparency level, a real number in (0, 1].
#&#39;
#&#39; @details See `names(ggsci:::ggsci_db)` for all color palette names in ggsci.
#&#39; See `names(ggsci:::ggsci_db$&quot;pal&quot;)` for available palette types under
#&#39; the palette `pal`.
pal_adaptive &lt;- function(name, palette, alpha = 1) {
  if (alpha &gt; 1L | alpha &lt;= 0L) stop(&quot;alpha must be in (0, 1]&quot;)

  raw_cols &lt;- ggsci:::ggsci_db[[name]][[palette]]
  raw_cols_rgb &lt;- col2rgb(raw_cols)
  alpha_cols &lt;- rgb(
    raw_cols_rgb[1L, ], raw_cols_rgb[2L, ], raw_cols_rgb[3L, ],
    alpha = alpha * 255L, names = names(raw_cols),
    maxColorValue = 255L
  )

  pal_ramp(unname(alpha_cols))
}</code></pre>
<style type="text/css">
blockquote code { font-size: 15px !important; }
</style>
<blockquote>
<p>NOTE: For technical reasons, the raw color data for the iTerm color palettes
and color scales (<code>pal_iterm()</code>, <code>scale_*_iterm()</code>) introduced in
ggsci 4.0.0 are stored in a separate object <code>ggsci:::ggsci_db_iterm</code>
rather than <code>ggsci:::ggsci_db</code>.</p>
<p>You can access the two variants (“normal” and “bright”) of these
palettes via, for example, <code>ggsci:::ggsci_db_iterm[["Palette Name"]][["normal"]]</code>
and <code>ggsci:::ggsci_db_iterm[["Palette Name"]][["bright"]]</code>.</p>
</blockquote>
<p>Finishing up by creating the ggplot2 color scales as usual.</p>
<pre class="r"><code>#&#39; Adaptive color scales
#&#39;
#&#39; @inheritParams pal_adaptive
#&#39; @param ... additional parameters for [ggplot2::discrete_scale()].
scale_color_adaptive &lt;- function(name, palette, alpha = 1, ...) {
  ggplot2::discrete_scale(&quot;colour&quot;, palette = pal_adaptive(name, palette, alpha), ...)
}

scale_fill_adaptive &lt;- function(name, palette, alpha = 1, ...) {
  ggplot2::discrete_scale(&quot;fill&quot;, palette = pal_adaptive(name, palette, alpha), ...)
}</code></pre>
<p>Feels easy enough? Let’s test it in the wild with some
high-cardinality data.</p>
<p>We trained some <a href="https://github.com/nanxstats/exp2vec">tissue-specific gene embeddings on GTEx data using GloVe</a>.
The embeddings are then projected to a 2D plane with t-SNE.</p>
<pre class="r"><code>word_vectors &lt;- readRDS(url(
  &quot;https://raw.githubusercontent.com/nanxstats/exp2vec/main/output/Pancreas_embedding.rds&quot;
))
tsne_out &lt;- readRDS(url(
  &quot;https://raw.githubusercontent.com/nanxstats/exp2vec/main/output/Pancreas_tsne.rds&quot;
))</code></pre>
<p>Run k-means clustering on the projected coordinates and get 15 clusters:</p>
<pre class="r"><code>set.seed(42)
cl &lt;- kmeans(word_vectors, centers = 15, iter.max = 20)
df &lt;- cbind(as.data.frame(tsne_out$Y), as.factor(cl$cluster))
names(df) &lt;- c(&quot;x&quot;, &quot;y&quot;, &quot;cluster&quot;)</code></pre>
<p>The <a href="https://nanx.me/ggsci/reference/pal_nejm.html">original color palette</a>
only has 8 colors, but it will work fine here:</p>
<pre class="r"><code>ggplot2::ggplot(df, ggplot2::aes(x = x, y = y)) +
  ggplot2::geom_point(ggplot2::aes(colour = cluster), alpha = 0.5, size = 1) +
  cowplot::theme_minimal_grid() +
  scale_color_adaptive(name = &quot;nejm&quot;, palette = &quot;default&quot;)</code></pre>
<p><img src="https://nanx.me/blog/post/ggplot2-color-interpolation/index_files/figure-html/unnamed-chunk-8-1.png" width="100%" /></p>
<p>That’s all, folks.</p>



        </div>

        
        <nav class="pagination-nav mt-10 mb-3" aria-label="Blog post navigation">
            <div class="navigation-btns">
                
                <a href="https://nanx.me/blog/post/shiny-fcp-loader/" class="btn-nav btn-prev w-full">
                    <div class="btn-content">
                        <div class="pagination-nav-sublabel">Previous</div>
                        <div class="pagination-nav-label">&laquo; Architecting Large Shiny Apps with Minimal First Contentful Paint Time</div>
                    </div>
                </a>
                

                
                <a href="https://nanx.me/blog/post/dt-news-list/" class="btn-nav btn-next w-full">
                    <div class="btn-content">
                        <div class="pagination-nav-sublabel">Next</div>
                        <div class="pagination-nav-label">Building Paginated News Lists in R Markdown and Shiny with DT &raquo;</div>
                    </div>
                </a>
                
            </div>
        </nav>
        

    </article>
</main>

<section id="comments">
    <div class="py-3 content">
        <div class="mx-auto max-w-[65ch] w-full px-4 sm:px-6">
            <div class="comments">
                <script src="https://utteranc.es/client.js" repo="nanxstats/blog-comments" issue-term="pathname"
                    label="comment" theme="github-light" crossorigin="anonymous" async>
                    </script>
            </div>
        </div>
    </div>
</section>
<footer class="mt-20 mb-10 text-center font-sans text-sm text-zinc-500 tracking-wide">
    <div class="tufte-grid">
        <div class="flex flex-col items-center gap-4">
            <div class="flex flex-wrap items-center justify-center gap-x-4 gap-y-2">
                
                
                <a href="https://github.com/nanxstats" target="_blank" rel="noopener"
                    class="hover:text-accent transition-colors">GitHub</a>
                
                
                
                
                <a href="https://www.linkedin.com/in/nanxstats" target="_blank" rel="noopener"
                    class="hover:text-accent transition-colors">LinkedIn</a>
                
                
                <a href="https://bsky.app/profile/nanxstats.bsky.social" target="_blank" rel="noopener"
                    class="hover:text-accent transition-colors">Bluesky</a>
                
                
                <a href="https://twitter.com/nanxstats" target="_blank" rel="noopener"
                    class="hover:text-accent transition-colors">Twitter</a>
                
                
                
                <a href="https://nanx.me/colophon/" class="hover:text-accent transition-colors">Colophon</a>
                
                
            </div>

            
            <div class="mt-2">
                © 2026 Nan Xiao. All rights reserved.
            </div>
            
        </div>
    </div>
</footer>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"
        integrity="sha512-EBLzUL8XLl+va/zAsmXwS7Z2B1F9HUHkZwyS/VKwh3S7T/U0nF4BaU29EP/ZSf6zgiIxYAnKLu6bJ8dqpmX5uw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/r.min.js" defer></script>
    
    <script>
        window.addEventListener('load', function () {
            hljs.highlightAll();
        }, true);
    </script>
    

    

    
    
    
<script src="https://nanx.me/js/math-code.js"></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
</body>

</html>