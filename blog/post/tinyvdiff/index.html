<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title> tinyvdiff: Minimalist visual regression testing plugin for pytest - Nan Xiao | 肖楠 </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="Introducing tinyvdiff, a minimalist pytest plugin for visual regression testing in Python. Designed for reproducible workflows, tinyvdiff converts PDFs into SVG snapshots for comparing appearance changes in graphics and documents. This post explores its motivation, methodology, and use cases.
" />

    
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:site_name" content="Nan Xiao | 肖楠" />
    <meta property="og:url" content="https://nanx.me/blog/post/tinyvdiff/" />
    <meta property="og:title" content="tinyvdiff: Minimalist visual regression testing plugin for pytest" />
    <meta property="og:description" content="Introducing tinyvdiff, a minimalist pytest plugin for visual regression testing in Python. Designed for reproducible workflows, tinyvdiff converts PDFs into SVG snapshots for comparing appearance changes in graphics and documents. This post explores its motivation, methodology, and use cases.
" />
    <meta property="og:image" content="https://nanx.me/image/zdenek-machacek-RiM-wOomC6w-unsplash.jpg" />
    <meta property="og:image:secure_url" content="https://nanx.me/image/zdenek-machacek-RiM-wOomC6w-unsplash.jpg" />
    <meta property="article:published_time" content="2024-12-04T21:53:00Z" />
    <meta property="article:modified_time" content="2024-12-04T21:53:00Z" />
    <meta property="article:author" content="Nan Xiao" />

    
    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:site" content="@nanxstats">
    <meta name="twitter:creator" content="@nanxstats">
    
    <meta name="twitter:title" content="tinyvdiff: Minimalist visual regression testing plugin for pytest" />
    <meta name="twitter:description" content="Introducing tinyvdiff, a minimalist pytest plugin for visual regression testing in Python. Designed for reproducible workflows, tinyvdiff converts PDFs into SVG snapshots for comparing appearance changes in graphics and documents. This post explores its motivation, methodology, and use cases.
" />
    <meta name="twitter:image" content="https://nanx.me/image/zdenek-machacek-RiM-wOomC6w-unsplash.jpg" />
    <meta name="twitter:image:alt" content="tinyvdiff: Minimalist visual regression testing plugin for pytest" />

    
    <meta property="og:linkedin:actor" content="nanxstats" />

    <link rel="canonical" href="https://nanx.me/blog/post/tinyvdiff/">

    
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        serif: ['"Martina Plantijn"', 'Newsreader', 'Georgia', 'Cambria', '"Times New Roman"', 'Times', 'serif'],
                        sans: ['"Instrument Sans"', 'system-ui', '-apple-system', '"Segoe UI"', 'Roboto', '"Helvetica Neue"', 'Arial', 'sans-serif'],
                        mono: ['"Liga Noto Sans Mono"', 'ui-monospace', 'SFMono-Regular', '"SF Mono"', 'Menlo', 'Consolas', 'monospace'],
                    },
                    colors: {
                        paper: '#fdfdfd',
                        ink: '#1c1c1c',
                        accent: '#991b1b',  
                    },
                    typography: {
                        DEFAULT: {
                            css: {
                                maxWidth: 'none',
                                color: '#1c1c1c',
                                '--tw-prose-body': '#1c1c1c',
                                '--tw-prose-headings': '#1c1c1c',
                                '--tw-prose-links': '#991b1b',
                                '--tw-prose-bold': '#111827',
                                '--tw-prose-counters': '#71717a',
                                '--tw-prose-bullets': '#d4d4d8',
                                '--tw-prose-hr': '#e4e4e7',
                                '--tw-prose-quotes': '#1c1c1c',
                                '--tw-prose-quote-borders': '#d4d4d8',
                                '--tw-prose-captions': '#71717a',
                                '--tw-prose-code': '#1c1c1c',
                                '--tw-prose-pre-code': '#1c1c1c',
                                '--tw-prose-pre-bg': '#fdfdfd',
                                '--tw-prose-th-borders': '#d4d4d8',
                                '--tw-prose-td-borders': '#e4e4e7',
                                'pre': {
                                    color: '#1c1c1c',
                                    backgroundColor: '#fdfdfd !important',
                                    border: '1px solid #e4e4e7',
                                },
                                a: {
                                    color: '#991b1b',
                                    textDecoration: 'none',
                                    fontWeight: '400',
                                    borderBottom: '1px solid transparent',
                                    transition: 'border-color 0.2s ease, color 0.2s ease',
                                },
                                'a:hover': {
                                    color: '#991b1b !important',
                                    borderBottomColor: '#991b1b !important',
                                },
                                h1: { fontFamily: '"Instrument Sans", sans-serif', fontWeight: '500', letterSpacing: '-0.025em' },
                                h2: { fontFamily: '"Instrument Sans", sans-serif', fontWeight: '500', letterSpacing: '-0.025em', marginTop: '2em' },
                                h3: { fontFamily: '"Instrument Sans", sans-serif', fontWeight: '500' },
                                h4: { fontFamily: '"Instrument Sans", sans-serif', fontWeight: '500' },
                                blockquote: {
                                    fontStyle: 'italic',
                                    fontWeight: '400',
                                    borderLeftWidth: '2px',
                                },
                                'code::before': { content: 'none' },
                                'code::after': { content: 'none' },
                                ':not(pre) > code': {
                                    fontWeight: '400',
                                    color: '#1c1c1c !important',
                                    backgroundColor: '#f4f4f5 !important',
                                    padding: '0.2em 0.4em',
                                    borderRadius: '0.25rem',
                                    fontSize: '0.875em',
                                },
                            },
                        },
                    },
                },
            },
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .tufte-grid {
                display: grid;
                grid-template-columns: 1fr min(65ch, 100%) 1fr;
                column-gap: 2rem;
            }
            .tufte-grid > * {
                grid-column: 2;
            }
            .tufte-grid > .full-width {
                grid-column: 1 / -1;
            }
            .tufte-grid > .margin-note {
                grid-column: 3;
                font-family: "Instrument Sans", sans-serif;
                font-size: 0.875rem;
                line-height: 1.4;
                color: #52525b;  
                margin-top: 0.25rem;
            }
            @media (max-width: 1024px) {
                .tufte-grid {
                    grid-template-columns: 1rem 1fr 1rem;
                }
                .tufte-grid > .margin-note {
                    grid-column: 2;
                    margin-top: 0.5rem;
                    margin-bottom: 1rem;
                    padding-left: 1rem;
                    border-left: 2px solid #e4e4e7;
                }
            }
        }
    </style>

    <link rel="stylesheet" href="https://nanx.me/css/custom.css" />

    
    <link rel="stylesheet" href="https://nanx.me/css/textmate.css" />
    

    

    <link rel="shortcut icon"
        href="https://nanx.me/image/favicon.png">

    
</head>

<body class="bg-paper text-ink font-serif antialiased selection:bg-zinc-200">
    
<header class="py-8 lg:py-12 text-sm font-sans tracking-wide max-w-[67ch] mx-auto w-full px-4 sm:px-6">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 sm:gap-0">
        <a href="https://nanx.me/" class="font-medium text-ink hover:text-accent transition-colors">
            Nan Xiao
        </a>
        <nav class="flex flex-wrap gap-4 sm:gap-6 text-zinc-600">
            
            
            <a class="text-ink font-medium"
                href="https://nanx.me/blog/">
                Blog
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/software/">
                Software
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/papers/">
                Papers
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/talks/">
                Talks
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/books/">
                Books
            </a>
            
            <a class="hover:text-accent transition-colors"
                href="https://nanx.me/about/">
                About
            </a>
            
        </nav>
    </div>
</header>

<main class="content my-10 max-w-[65ch] mx-auto w-full px-4 sm:px-6">
    <article>
        <header class="mb-14">
            <h1 class="text-3xl lg:text-4xl font-sans tracking-tight text-ink font-medium mb-4">tinyvdiff: Minimalist visual regression testing plugin for pytest</h1>

            <div class="text-zinc-500 font-sans text-sm tracking-wide">
                
                
                <span class="author" title="Nan Xiao">
                    Nan Xiao
                </span>
                
                

                <span class="date middot tabular-nums" title='Wed Dec 4 2024 21:53:00 UTC'>
                    December 4, 2024
                </span>

                <span class="reading-time middot">
                    2 min read
                </span>

                <div class="mt-8 flex flex-wrap gap-2">
                    
                    <a href="https://nanx.me/tags/python"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-zinc-100 text-zinc-600 hover:bg-zinc-200 hover:text-ink transition-colors text-xs font-medium tracking-wide">
                        Python
                    </a>
                    
                    <a href="https://nanx.me/tags/python-packages"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-zinc-100 text-zinc-600 hover:bg-zinc-200 hover:text-ink transition-colors text-xs font-medium tracking-wide">
                        Python packages
                    </a>
                    
                    <a href="https://nanx.me/tags/pytest"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-zinc-100 text-zinc-600 hover:bg-zinc-200 hover:text-ink transition-colors text-xs font-medium tracking-wide">
                        pytest
                    </a>
                    
                    <a href="https://nanx.me/tags/visual-regression-testing"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-zinc-100 text-zinc-600 hover:bg-zinc-200 hover:text-ink transition-colors text-xs font-medium tracking-wide">
                        visual regression testing
                    </a>
                    
                    <a href="https://nanx.me/tags/software-engineering"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-zinc-100 text-zinc-600 hover:bg-zinc-200 hover:text-ink transition-colors text-xs font-medium tracking-wide">
                        software engineering
                    </a>
                    
                    
                    
                </div>
            </div>

        </header>

        <div class="prose prose-zinc max-w-none">
            
    


<div class="float">
<img src="https://nanx.me/image/zdenek-machacek-RiM-wOomC6w-unsplash.jpg" alt="Hummingbirds. Photo by Zdeněk Macháček." />
<div class="figcaption">Hummingbirds.
Photo by <a href="https://unsplash.com/photos/RiM-wOomC6w">Zdeněk Macháček</a>.</div>
</div>
<p>I’m delighted to announce my second Python package,
<a href="https://nanx.me/tinyvdiff/">tinyvdiff</a>, now available on PyPI.
It offers a lightweight pytest plugin for detecting appearance changes
in visual content, such as figures or documents. You can install it with:</p>
<pre class="bash"><code>pip install tinyvdiff</code></pre>
<div id="setup-and-usage" class="section level2">
<h2>Setup and usage</h2>
<p>Here is an example test for matplotlib graphics,
from the <a href="https://github.com/nanxstats/tinyvdiff-demo">tinyvdiff demo project</a>:</p>
<pre class="python"><code>import pytest

from tinyvdiff_demo.matplotlib import generate_plot


@pytest.fixture
def temp_pdf(tmp_path):
    &quot;&quot;&quot;Fixture to create a temporary PDF file path&quot;&quot;&quot;
    return tmp_path / &quot;test.pdf&quot;


def test_matplotlib_visual(tinyvdiff, temp_pdf):
    &quot;&quot;&quot;Test visual regression with PDF generated with matplotlib&quot;&quot;&quot;
    pdf_path = generate_plot(temp_pdf)
    tinyvdiff.assert_pdf_snapshot(pdf_path, &quot;snapshot_matplotlib.svg&quot;)</code></pre>
<p>See the <a href="https://nanx.me/tinyvdiff/articles/setup/">setup guide</a> to learn
how to integrate tinyvdiff into your Python project and use it
in CI/CD systems like GitHub Actions.</p>
</div>
<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>While transitioning parts of my toolchain to Python, I encountered a need
for a unified approach to test the visual appearance of rendered outputs,
such as graphics and documents.
In R, tools like <a href="https://testthat.r-lib.org/articles/snapshotting.html">testthat snapshot
tests</a> and
<a href="https://vdiffr.r-lib.org/">vdiffr</a> address similar needs effectively.
However, with all the flexibility, I saw an opportunity to explore this
space a bit more in Python.</p>
</div>
<div id="the-trilemma" class="section level2">
<h2>The trilemma</h2>
<p>The design considerations for tinyvdiff are detailed in its
<a href="https://nanx.me/tinyvdiff/articles/design/">design document</a>.
In brief, I identified three key requirements that define a trilemma
for visual regression testing:</p>
<ol style="list-style-type: decimal">
<li><strong>Support for diverse input formats</strong>:
Handle graphics and documents produced by different backends.</li>
<li><strong>Bitwise reproducibility of snapshots</strong>:
Store snapshots in plain text for easy version control and comparison.</li>
<li><strong>Environment consistency</strong>:
Generate consistent snapshots across operating systems.</li>
</ol>
</div>
<div id="my-solution" class="section level2">
<h2>My solution</h2>
<p>Given the constraints of this trilemma:</p>
<ul>
<li>Dropping constraints 2 and 3 leads to testthat “whole file snapshotting”.</li>
<li>Dropping constraint 1 while keeping 2 and 3 leads to vdiffr.</li>
<li>Dropping constraint 3 while keeping 1 and 2 gives tinyvdiff.</li>
</ul>
<p>tinyvdiff operates on the assumption that visual regression tests will be
running on a single platform. Developers are also trusted to prepare
reproducible PDF inputs in their preferred way.
The package then uses <code>pdf2svg</code> (built on Poppler and Cairo) to
convert PDF files into SVG snapshots for comparison.</p>
</div>
<div id="use-cases" class="section level2">
<h2>Use cases</h2>
<p>tinyvdiff may be a good fit for projects where:</p>
<ul>
<li>Visual tests can be sufficiently done on a single platform.</li>
<li>Multiple types of visual content require appearance testing.</li>
<li>PDF inputs are reproducible and contain mostly vector elements.</li>
<li>Snapshots remain manageable in size and complexity.</li>
</ul>
<p>If any of these conditions are not met, other more focused approaches
might better suit your needs. For example, matplotlib has built-in
<a href="https://matplotlib.org/stable/api/testing_api.html">testing helpers for image comparison</a>,
which works great for testing the appearance of its outputs.</p>
</div>



        </div>

        
        <nav class="pagination-nav mt-10 mb-3" aria-label="Blog post navigation">
            <div class="navigation-btns">
                
                <a href="https://nanx.me/blog/post/tinytopics/" class="btn-nav btn-prev w-full">
                    <div class="btn-content">
                        <div class="pagination-nav-sublabel">Previous</div>
                        <div class="pagination-nav-label">&laquo; tinytopics: GPU-accelerated topic modeling via constrained neural Poisson NMF</div>
                    </div>
                </a>
                

                
                <a href="https://nanx.me/blog/post/rstudio-splash-screen/" class="btn-nav btn-next w-full">
                    <div class="btn-content">
                        <div class="pagination-nav-sublabel">Next</div>
                        <div class="pagination-nav-label">Skip RStudio splash screen &raquo;</div>
                    </div>
                </a>
                
            </div>
        </nav>
        

    </article>
</main>

<section id="comments">
    <div class="py-3 content">
        <div class="mx-auto max-w-[65ch] w-full px-4 sm:px-6">
            <div class="comments">
                <script src="https://utteranc.es/client.js" repo="nanxstats/blog-comments" issue-term="pathname"
                    label="comment" theme="github-light" crossorigin="anonymous" async>
                    </script>
            </div>
        </div>
    </div>
</section>
<footer class="mt-20 mb-10 text-center font-sans text-sm text-zinc-500 tracking-wide">
    <div class="tufte-grid">
        <div class="flex flex-col items-center gap-4">
            <div class="flex flex-wrap items-center justify-center gap-x-4 gap-y-2">
                
                
                <a href="https://github.com/nanxstats" target="_blank" rel="noopener"
                    class="hover:text-accent transition-colors">GitHub</a>
                
                
                
                
                <a href="https://www.linkedin.com/in/nanxstats" target="_blank" rel="noopener"
                    class="hover:text-accent transition-colors">LinkedIn</a>
                
                
                <a href="https://bsky.app/profile/nanxstats.bsky.social" target="_blank" rel="noopener"
                    class="hover:text-accent transition-colors">Bluesky</a>
                
                
                <a href="https://twitter.com/nanxstats" target="_blank" rel="noopener"
                    class="hover:text-accent transition-colors">Twitter</a>
                
                
                
                <a href="https://nanx.me/colophon/" class="hover:text-accent transition-colors">Colophon</a>
                
                
            </div>

            
            <div class="mt-2">
                © 2026 Nan Xiao. All rights reserved.
            </div>
            
        </div>
    </div>
</footer>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"
        integrity="sha512-EBLzUL8XLl+va/zAsmXwS7Z2B1F9HUHkZwyS/VKwh3S7T/U0nF4BaU29EP/ZSf6zgiIxYAnKLu6bJ8dqpmX5uw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/r.min.js" defer></script>
    
    <script>
        window.addEventListener('load', function () {
            hljs.highlightAll();
        }, true);
    </script>
    

    

    
    
    

    
</body>

</html>